<!doctype html>
<html lang="en">
	<head>
		<meta charset=utf-8>
		<meta name=description content="">
		<meta name=viewport content="width=device-width, initial-scale=1">
		<title>Jquery Comments Plugin</title>

		<!-- Styles -->
		<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

		<!-- Data -->
		<script type="text/javascript" src="test/data/comments-data.js"></script>

		<!-- Libraries -->
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery.textcomplete/1.8.0/jquery.textcomplete.js"></script>
		<script type="text/javascript" src="src/comments-component.js"></script>

		<style type="text/css">
			body {
				padding: 20px;
				margin: 0px;
				font-size: 14px;
				font-family: "Arial", Georgia, Serif;
			}
		</style>
	</head>
	<body>
		<ax-comments id="demo-comments-container"></ax-comments>

		<!-- Init jquery-comments -->
		<script type="text/javascript">
			const saveComment = data => {
				// Convert pings to human readable format
				Object.keys(data.pings).forEach((userId) => {
					const fullname = data.pings[userId];
					const pingText = '@' + fullname;
					data.content = data.content.replace(new RegExp('@' + userId, 'g'), pingText);
				});

				return data;
			};

			document.getElementById('demo-comments-container').options({
				profilePictureURL: 'https://viima-app.s3.amazonaws.com/media/public/defaults/user-icon.png',
				currentUserId: 1,
				roundProfilePictures: true,
				textareaRows: 1,
				enableAttachments: true,
				enableHashtags: true,
				enablePinging: true,
				searchUsers: (term, success, error) => {
					setTimeout(() => {
						success(usersArray.filter(user => {
							const containsSearchTerm = user.fullname.toLowerCase().indexOf(term.toLowerCase()) !== -1;
							const isNotSelf = user.id !== 1;
							return containsSearchTerm && isNotSelf;
						}));
					}, 500);
				},
				getComments: (success, error) => {
					setTimeout(() => {
						success(commentsArray);
					}, 500);
				},
				postComment: (data, success, error) => {
					setTimeout(() => {
						success(saveComment(data));
					}, 500);
				},
				putComment: (data, success, error) => {
					setTimeout(() => {
						success(saveComment(data));
					}, 500);
				},
				deleteComment: (data, success, error) => {
					setTimeout(() => {
						success();
					}, 500);
				},
				upvoteComment: (data, success, error) => {
					setTimeout(() => {
						success(data);
					}, 500);
				},
				validateAttachments: (attachments, callback) => {
					setTimeout(() => {
						callback(attachments);
					}, 500);
				},
			});
		</script>
	</body>
</html>
